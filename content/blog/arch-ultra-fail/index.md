---
title: 'Почти история успеха: как поставить Арч и всё потерять'
description: "Не пытайтесь повторить это дома."
date: 2014-10-31T12:40:23Z
tags:
- Linux
archived: true
comments: true
---

Вообще, историю моих скитаний по линукс-дистрибутивам можно рассказывать долго, но я расскажу свежую и относительно весёлую: как я на Арч мигрировал.

<!--more-->

### 1. Как я всё потерял

Изначальной предпосылкой было то, что меня достал Crunchbang. Этот дистрибутив на базе Debian с Openbox на борту хорош всем, на самом деле, кроме одного: он построен на Debian Stable. Stable недаром зовётся стабильным - весь софт в нём не просто старый, а ОЧЕНЬ старый, и обновляться на актуальные версии не спешит. Как следствие, ни свежий MySQL Workbench поставить не получится, ни Steam, даже Iron Browser, собранный с свежим glibc, не запустится. В итоге я решил переехать на Debian Testing, заменил репозитории и обновился. Crunchbang развалился.

Точнее, развалилась их фирменная тема wardolf, поставляемая с дистрибутивом - да и многие GNOME-утилиты, поставляемые с дистрибутивом, стали выглядеть в стиле этого самого GNOME 3, что не очень приятно. В итоге, я поставил KDE, настроил его и успокоился - теперь это уже был не Crunchbang, а Debian Testing, и почти всё работало. Но дьявол - он в мелочах. Стандартные настройки Crunchbang явно конфликтовали с настройками Testing, в итоге, я получал очень весёлые глюки. Прошёл месяц, и это меня достало, я решил снова переустанавливать систему.

Выбор у меня был из двух ~~стульев~~ вариантов - либо ставить Debian Testing с нуля, либо поставить какой-то другой дистрибутив. Тут уже я вспомнил про Arch - невероятно удобный компактный линукс, у которого ещё и пакетный менеджер реактивный, и AUR (огромный репозиторий с сторонним софтом) присутствует, причём часто в нём есть софт, который нельзя найти ни в одном дистрибутиве (например, шрифты от Microsoft). Таким образом, решение было принято - ставим Арч. Вот тут и началось.

У меня в ноутбуке стоит два жёстких диска: стандартный SSD на 120 гигабайт с системой и софтом, и HDD на 500 гигабайт с фильмами, музыкой и данными. Первый обозначен в системе как /dev/sda, второй как /dev/sdb, флешка, на которую я записывал установочный образ Арча - /dev/sdd. Я перенёс все данные на второй жёсткий диск, скачал образ archlinux-2014.10.01.iso и набрал в консоли:

```
dd if=archlinux-2014.10.01.iso of=/dev/sd**b**
```

Да, в этом была моя огромная ошибка, я по привычке набрал /dev/sdb (до покупки SSD там всегда была флешка), в итоге, я сломал файловую систему. Полностью. Исправлять было уже поздно, я кинулся за внешним HDD и начал копировать на него всё содержимое перезатёртого диска (оно, несмотря на зверскую экзекуцию, всё ещё читалось). Успел скопировать IT-книги и фильмы - потом до ОС дошло, что я только что натворил, и раздел перестал читаться.

Следующие 14 часов я всеми мыслимыми усилиями восстанавливал содержимое жёсткого диска. В ход пошёл R-Studio, R-Linux, ext4undelete, testdisk и прочие утилиты для восстановления данных - но восстановить ими почти ничего не удалось, файловая система была безнадёжно испорчена. Особенно жалко фотографии - у меня не осталось их резервной копии. Но отступать было уже поздно, и я со второй попытки я записал установочный образ Arch Linux на флэшку.

### 2. Как я установил Arch

С начала установки прошло уже 24 часа (начинал я ставить вечером среды, а к установке приступил в четверг вечером), и мелкий облом не заставил себя ждать - образ с арчем, который сейчас лежит на archlinux.org, не работает. Причина, если кратко - внутренний раздел с RootFS обозван ARCH_201410, как и сам диск, в итоге, система не может понять, какой из двух разделов ей монтировать и отказывается грузиться. Если надумаете ставить Арч - грузите лучше образ от 2014.09.03, он работает, а разницы в процессе установки нет.

{{< img_url "https://pbs.twimg.com/media/B1NTkJgIAAEmkzm.jpg:large" "800" "">}}

Далее установка проходит согласно [этой](https://wiki.archlinux.org/index.php/Installation_guide) инструкции без особых проблем, и базовая система у вас уже стоит. Однако, я тут наткнулся на второй косяк - поскольку я хотел сразу систему с KDE, то я поставил полный пакет kde, но этот пакет не потянул за собой xorg-server! Как kde будет работать без xorg - вопрос актуальный. У меня не заработал - после загрузки установленной ОС остался наедине с чёрной консолью и даже без возможности доустановить пакеты (кстати, тут косяк №3 - если у вас Wi-Fi, обязательно поставьте пакет dialog при установке системы, иначе стандартный wifi-menu не заработает, а при отсутствующем NetworkManager или wicd - это единственная возможность поднять Wi-Fi из консоли.

После доустановки xorg-server и NetworkManager (кстати, не забудьте поставить их в автозагрузку - для этого надо набрать *systemctl enable kdm* и *systemctl enable NetworkManager*), жизнь становится куда веселее. Но не в моём случае - после установки я захотел скопировать спасённые данные обратно на жёсткий диск. Копирование прошло без проблем, но я решил заодно монтировать этот диск при загрузке и прописал его в fstab. Да, тот самый раздел, на котором 14 часов искались файлы. В итоге, при загрузке система начала проверять диск на ошибки, а я прошёл весёлый квест, заключающийся в бесперерывном нажатии кнопки Enter. Три часа подряд. В конце, я не выдержал и поставил отвёртку на клавишу - дело пошло куда веселее

{{< img_url "https://pbs.twimg.com/media/B1OevLdCAAAqkxN.jpg" "800" "">}}

Ещё через два часа проверка закончилась, и вот я пишу уже из Арча.

Какая мораль у этой истории? Их целых три: не меняйте ОС без особой нужды, делайте резервные копии важных файлов, читайте документацию перед установкой незнакомой ОС. Тогда вам не придётся сидеть над установкой 36 часов, как мне.
